<!doctype html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
		  name="viewport">
	<meta content="ie=edge" http-equiv="X-UA-Compatible">
	<title>Библиотека - Список книг</title>
	<link href="css/freemarker.css" rel="stylesheet">
</head>
<body>

<div class="container">
	<div class="card">
		<h1>Библиотека</h1>

		<table class="book-table">
			<thead>
			<tr>
				<th>ID</th>
				<th>Название</th>
				<th>Автор</th>
				<th>Статус</th>
				<th>Сотрудник</th>
				<th>Действие</th>
			</tr>
			</thead>
			<tbody>
			<#list booksList as book>
			<tr>
				<td>${book.id}</td>
				<td><strong>${book.title}</strong></td>
				<td>${book.author}</td>
				<td>
					<#if book.status == "Available">
					<span class="badge available">Доступна</span>
					<#else>
					<span class="badge issued">Выдана</span>
				</#if>
				</td>
				<td>
					<#if book.status != "Available">
					<#assign holderName = "(Неизвестен)">
					<#list records?keys as employee>
					<#list records[employee].currentBooks![] as currentBook>
					<#if currentBook.id == book.id>
					<#assign holderName = "${employee.firstName} ${employee.lastName}">
					<a href="/employee?id=${employee.id}">${holderName}</a>
					<#break>
				</#if>
			</#list>
			<#if holderName != "(Неизвестен)">
			<#break>
			</#if>
		</#list>
		<#if holderName == "(Неизвестен)">
		<span style="color: gray;">${holderName}</span>
	</#if>
</#if>
</td>
<td>
	<a href="/book?id=${book.id}" class="btn">Подробнее</a>
</td>
</tr>
</#list>
</tbody>
</table>
</div>
</div>

<div class="container">
	<div class="card">
		<h1>Список сотрудников</h1>

		<table class="book-table">
			<thead>
			<tr>
				<th>Сотрудник</th>
				<th>Должность</th>
				<th>Текущие книги</th>
				<th>Прочитанные книги</th>
				<th>Действия</th>
			</tr>
			</thead>
			<tbody>
			<#list records as employee, record>
			<tr>
				<td><a href="/employee?id=${employee.id}">
					${employee.firstName} ${employee.lastName}
				</a></td>
				<td>${employee.position}</td>

				<td>
					<#list record.currentBooks![] as book>
					• ${book.title} <#sep><br></#sep>
			</#list>
			</td>

			<td>
				<#list record.previousBooks![] as book>
				✔ ${book.title} <#sep><br></#sep>
			</#list>
			</td>

			<td>
				<a href="/books" class="btn">Открыть</a>
			</td>
			</tr>
		</#list>
		</tbody>
		</table>
	</div>
</div>

</body>
</html>
