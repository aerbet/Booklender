<!doctype html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
		  name="viewport">
	<meta content="ie=edge" http-equiv="X-UA-Compatible">
	<title>${book.title} - Детали</title>
	<link href="css/freemarker.css" rel="stylesheet">
</head>
<body>

<div class="container">
	<a href="/books" style="color: #666; text-decoration: none;">← Вернуться к списку</a>
	<br><br>

	<div class="card">
		<div class="book-details-grid">
			<div>
				<img src="${book.image}"
					 alt="Обложка книги" class="book-cover">
			</div>

			<div>
				<h1>${book.title}</h1>
				<h2>${book.author}</h2>
				<hr>

				<p><strong>Жанр:</strong> ${book.genre!"Не указан"}</p>
				<p><strong>Описание:</strong></p>
				<p>${book.description!"Описания пока нет."}</p>

							<div style="margin-top: 20px;">
								<p><strong>Текущий статус:</strong></p>

								<#assign isAvailable = (book.status == "Available")>
								<#assign isCurrentUserHolder = (currentUser?? && book.status == currentUser.id)>

								<#if isAvailable>
								<span class="badge available" style="font-size: 1.2rem;">На полке</span>
								<#else>
								<span class="badge issued" style="font-size: 1.2rem;">Выдана:
									<#if holder??>
											<a href="/employee?id=${holder.id}">${holder.firstName} ${holder.lastName}</a>
									<#else>
											(Неизвестно)
									</#if>
								</span>
							</#if>

							<br><br>

				<#if currentUser??>
				<#assign canIssue = (currentBooksCount < 2)>

				<#if isAvailable>
				<#if canIssue>
				<form method="POST" action="/issue">
					<input type="hidden" name="bookId" value="${book.id}">
					<button type="submit" class="btn">Забрать книгу</button>
				</form>
				<#else>
				<span style="color: #c9302c; font-weight: bold;">
                        Превышен лимит (у вас ${currentBooksCount} из 2 книг). <br>
												Одному сотруднику даем не более 2х книг в руки.
                    </span>
			</#if>
			<#elseif isCurrentUserHolder>
			<form method="POST" action="/return">
				<input type="hidden" name="bookId" value="${book.id}">
				<button type="submit" class="btn btn-red">Вернуть книгу</button>
			</form>
		</#if>
		<#else>
		<span style="color: gray;">Для действий с книгой необходимо <a href="/login">авторизоваться</a>.</span>
	</#if>
				</div>
			</div>
		</div>
	</div>
</div>

</body>
</html>